<?php

/**
 * @copyright Copyright (c) Metaways Infosystems GmbH, 2012
 * @license LGPLv3, http://www.arcavias.com/en/license
 */

if( isset( $this->standardBasket ) )
{
	$price = $this->standardBasket->getPrice();
	$priceValue = $price->getValue();
	$priceShipping = $price->getShipping();
	$priceCurrency = $this->translate( 'core/client/html/currency', $price->getCurrencyId() );
}
else
{
	$priceValue = '0.00';
	$priceShipping = '0.00';
	$priceCurrency = '';
}

try {
	$paymentPrice = $this->standardBasket->getService( 'payment' )->getPrice()->getValue();
} catch( Exception $e ) {
	$paymentPrice = '0.00';
}

$priceFormat = $this->translate( 'core/client/html', '%1$s%2$s' );

?>
<div class="basket-standard-main">
	<form method="POST" action="<?php echo $this->url( $this->config( 'basket-target' ), 'basket', 'index' ); ?>">
		<input type="hidden" name="<?php echo $this->formparam( 'b-action' ); ?>" value="edit" />
		<table>
			<thead>
				<tr class="main-head">
					<th class="main-details"></th>
					<th class="main-quantity"><?php echo $this->translate( 'core/client/html', 'Quantity' ); ?></th>
					<th class="main-unitprice"><?php echo $this->translate( 'core/client/html', 'Price' ); ?></th>
					<th class="main-price"><?php echo $this->translate( 'core/client/html', 'Sum' ); ?></th>
					<th class="main-action"></th>
				</tr>
			</thead>
			<tbody>
<?php if( isset( $this->standardBasket ) ) : ?>
<?php 	foreach( $this->standardBasket->getProducts() as $position => $product ) : ?>
				<tr class="main-row">
					<td class="main-details">
						<img src="<?php echo $product->getMediaUrl(); ?>" />
						<span class="product-name"><?php echo $product->getName(); ?></span>
<?php		foreach( $product->getAttributes() as $attribute ) : ?>
						<span class="product-attributename"><?php echo $attribute->getName(); ?></span>
						<span class="product-attributevalue"><?php echo $attribute->getValue(); ?></span>
<?php		endforeach; ?>
					</td>
<?php		$prodPrice = $product->getPrice()->getValue(); ?>
					<td class="main-quantity">
<?php		if( $product->getQuantity() > 1 ) : ?>
						<a href="<?php echo $this->url( $this->config( 'basket-target' ), 'basket', 'index', array( 'b-action' => 'edit', 'b-position' => $position, 'b-quantity' => $product->getQuantity() - 1 ) ); ?>">-</a>
<?php		endif; ?>
						<input type="text" name="<?php echo $this->formparam( array( 'b-prod', $position, 'quantity' ) ); ?>" value="<?php echo $product->getQuantity(); ?>" />
						<input type="hidden" name="<?php echo $this->formparam( array( 'b-prod', $position, 'position' ) ); ?>" value="<?php echo $position; ?>" />
						<a href="<?php echo $this->url( $this->config( 'basket-target' ), 'basket', 'index', array( 'b-action' => 'edit', 'b-position' => $position, 'b-quantity' => $product->getQuantity() + 1 ) ); ?>">+</a>
					</td>
					<td class="main-unitprice"><?php printf( $priceFormat, $this->number( $prodPrice ), $priceCurrency ); ?></td>
					<td class="main-price"><?php printf( $priceFormat, $this->number( $prodPrice * $product->getQuantity() ), $priceCurrency ); ?></td>
					<td class="main-action">
						<a class="minibutton" href="<?php echo $this->url( $this->config( 'basket-target' ), 'basket', 'index', array( 'b-action' => 'delete', 'b-position' => $position ) ); ?>"><?php echo $this->translate( 'core/client/html', 'X' ); ?></a>
					</td>
				</tr>
<?php 	endforeach; ?>
<?php endif; ?>
			</tbody>
			<tfoot>
				<tr class="main-subtotal">
					<td colspan="3"><?php echo $this->translate( 'core/client/html', 'Sub-total' ); ?></td>
					<td class="main-price"><?php printf( $priceFormat, $this->number( $priceValue ), $priceCurrency ); ?></td>
					<td class="main-action"></td>
				</tr>
				<tr class="main-delivery">
					<td colspan="3"><?php echo $this->translate( 'core/client/html', 'Shipping' ); ?></td>
					<td class="main-price"><?php printf( $priceFormat, $this->number( $priceShipping ), $priceCurrency ); ?></td>
					<td class="main-action"></td>
				</tr>
<?php if( $paymentPrice > 0 ) : ?>
				<tr class="main-payment">
					<td colspan="3"><?php echo $this->translate( 'core/client/html', 'Payment costs' ); ?></td>
					<td class="main-price"><?php printf( $priceFormat, $this->number( $paymentPrice ), $priceCurrency ); ?></td>
					<td class="main-action"></td>
				</tr>
<?php endif; ?>
				<tr class="main-total">
					<td colspan="3"><?php echo $this->translate( 'core/client/html', 'Total' ); ?></td>
					<td class="main-price"><?php printf( $priceFormat, $this->number( $priceValue + $priceShipping ), $priceCurrency ); ?></td>
					<td class="main-action"></td>
				</tr>
			</tfoot>
		</table>
		<div class="main-buttons">
			<button class="standardbutton" type="submit"><?php echo $this->translate( 'core/client/html', 'Update' ); ?></button>
			<a class="standardbutton" href="<?php echo $this->url( $this->config( 'checkout-target' ), 'basket', 'checkout' ); ?>"><?php echo $this->translate( 'core/client/html', 'Checkout' ); ?></a>
		</div>
	</form>
</div>
<?php echo $this->get( 'mainBody' ); ?>
