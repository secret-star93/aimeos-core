<?php

/**
 * @copyright Copyright (c) Metaways Infosystems GmbH, 2013
 * @license LGPLv3, http://www.arcavias.com/en/license
 */


$activeStep = $this->get( 'standardStepActive' );
$steps = $this->get( 'standardSteps', array() );
$step = null;

do {
	$lastStep = $step;
} while( ( $step = array_shift( $steps ) ) !== null && $step !== $activeStep );
$nextStep = ( ( $step = array_shift( $steps ) ) !== null ? $step : null );

if( $lastStep ) {
	$urlBack = $this->url( 'checkout-target', 'checkout', 'index', array( 'c-step' => $lastStep ) );
} else {
	$urlBack = $this->url( 'basket-target', 'basket', 'index' );
}

$serviceAttributes = $this->get( 'deliveryAttributes', array() );

?>
<div class="checkout-standard-delivery">
	<h1><?php echo $this->translate( 'core/client/html', 'delivery' ); ?></h1>
	<p class="delivery-note"><?php $this->translate( 'core/client/html', 'Please choose your delivery method' ); ?></p>
	<form method="POST" action="<?php echo $this->url( 'checkout-target', 'checkout', 'index', array( 'c-step' => $nextStep ) ); ?>">
<?php foreach( $this->get( 'deliveryServices', array() ) as $id => $service ) : ?>
		<div class="delivery-item">
			<input type="radio" value="<?php echo $id; ?>" />
			<div class="item-basic">
				<div class="item-icons">
<?php	foreach( $service->getRefItems( 'media', 'icon', 'default' ) as $mediaItem ) : ?>
					<img href="<?php echo $mediaItem->getUrl(); ?>" />
<?php	endforeach; ?>
				</div>
				<h2><?php echo $service->getName(); ?></h2>
<?php	foreach( $service->getRefItems( 'text', null, 'default' ) as $textItem ) : ?>
				<p class="<?php echo $textItem->getType(); ?>"><?php echo $textItem->getContent(); ?></p>
<?php	endforeach; ?>
			</div>
			<ul class="item-attributes">
<?php	if( isset( $serviceAttributes[$id] ) ) : ?>
<?php		foreach( $serviceAttributes[$id] as $key => $attribute ) : ?>
				<li class="attribute-item <?php echo $key . ( isset( $deliveryCss[$key] ) ? ' ' . join( ' ', $deliveryCss[$key] ) : '' ); ?>">
					<label for="delivery-<?php echo $key; ?>"><?php echo $this->translate( 'core/client/html/service', $key ); ?></label>
					<input type="text" id="delivery-<?php echo $key; ?>" name="c-delivery[<?php echo $id; ?>][<?php echo $key; ?>]" value="<?php echo $this->param( 'c-delivery/' . $id . '/' . $key, '' ); ?>" />
				</li>
<?php		endforeach; ?>
<?php	endif; ?>
			</ul>
		</div>
<?php endforeach; ?>
<?php echo $this->get( 'deliveryBody' ); ?>
		<div class="button-group">
			<a class="standardbutton" href="<?php echo $urlBack; ?>"><?php echo $this->translate( 'core/client/html', 'Back' ); ?></a> 
			<button class="standardbutton"><?php echo $this->translate( 'core/client/html', 'Next' ); ?></button>
		</div>
	</form>
</div>
